{"version":3,"file":"statebot-react-hooks.dev.js","sources":["../../src/index.js"],"sourcesContent":["import { useState, useEffect, useMemo } from 'react'\nimport { Statebot } from 'statebot'\n\n//\n// Use an existing Statebot\n//\nexport function useStatebot (bot) {\n  const [state, setState] = useState(bot.currentState())\n\n  useEffect(() => {\n    let done = false\n\n    const removeListener = bot.onSwitched(toState => {\n      if (!done) {\n        setState(toState)\n      }\n    })\n\n    return () => {\n      done = true\n      removeListener()\n    }\n  }, [bot])\n\n  return state\n}\n\n//\n// Create a new Statebot within a Component\n//\n\n// TODO: Needs same TLC as other hooks\nexport function useStatebotFactory(name, config) {\n  const _config = useMemo(() => config, [name])\n  const listeners = []\n  useEffect(() => () => listeners.forEach(off => off()), [_config])\n\n  // We memoise Statebot since it's based on EventEmitter,\n  // so we create it once and add/remove listeners for\n  // the life-cycle of the component\n  const bot = useMemo(() => {\n    const { performTransitions, onTransitions, ...botConfig } = _config || {}\n    const bot = Statebot(name, botConfig)\n    listeners.push(\n      bot.performTransitions(performTransitions || {}),\n      bot.onTransitions(onTransitions || {})\n    )\n    return bot\n  }, [name, _config])\n\n  const state = useStatebot(bot)\n\n  return { state, bot }\n}\n\n//\n// Listen to Statebot events with automatic cleanup\n//\nexport function useStatebotEvent (bot, eventName, stateOrFn, maybeFn) {\n  useEffect(() => {\n\n    let done = false\n\n    function onSwitchFn(...args) {\n      if (!done) {\n        stateOrFn(...args)\n      }\n    }\n    function onEnterOrExitFn(...args) {\n      if (!done) {\n        maybeFn(...args)\n      }\n    }\n\n    const args = typeof maybeFn === 'function'\n      ? [stateOrFn, onEnterOrExitFn]\n      : [onSwitchFn]\n\n    const removeListener = bot[eventName](...args)\n\n    return () => {\n      done = true\n      removeListener()\n    }\n  }, [bot, eventName, stateOrFn, maybeFn])\n}\n"],"names":["useStatebot","bot","useState","currentState","state","setState","useEffect","done","removeListener","onSwitched","toState","useStatebotFactory","name","config","_config","useMemo","listeners","forEach","off","performTransitions","onTransitions","botConfig","Statebot","push","useStatebotEvent","eventName","stateOrFn","maybeFn","onSwitchFn","onEnterOrExitFn","args"],"mappings":"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"}