{"version":3,"file":"statebot-react-hooks.dev.js","sources":["../../src/index.js"],"sourcesContent":["import { useState, useEffect, useMemo } from 'react'\nimport { Statebot } from 'statebot'\n\n//\n// Use an existing Statebot\n//\nexport function useStatebot (bot) {\n  const [state, setState] = useState(bot.currentState())\n\n  useEffect(() => {\n    let done = false\n\n    const removeListener = bot.onSwitched(toState => {\n      if (!done) {\n        setState(toState)\n      }\n    })\n\n    return () => {\n      done = true\n      removeListener()\n    }\n  }, [bot])\n\n  return state\n}\n\n//\n// Create a new Statebot within a Component\n//\n\n// TODO: Needs same TLC as other hooks\nexport function useStatebotFactory(name, config) {\n  const _config = useMemo(() => config, [name])\n  const listeners = []\n  useEffect(() => () => listeners.forEach(off => off()), [_config])\n\n  // We memoise Statebot since it's based on EventEmitter,\n  // so we create it once and add/remove listeners for\n  // the life-cycle of the component\n  const bot = useMemo(() => {\n    const { performTransitions, onTransitions, ...botConfig } = _config || {}\n    const bot = Statebot(name, botConfig)\n    listeners.push(\n      bot.performTransitions(performTransitions || {}),\n      bot.onTransitions(onTransitions || {})\n    )\n    return bot\n  }, [name, _config])\n\n  const state = useStatebot(bot)\n\n  return { state, bot }\n}\n\n//\n// Listen to Statebot events with automatic cleanup\n//\nexport function useStatebotEvent (bot, eventName, stateOrFn, maybeFn) {\n  useEffect(() => {\n\n    let done = false\n\n    function onSwitchFn(...args) {\n      if (!done) {\n        stateOrFn(...args)\n      }\n    }\n    function onEnterOrExitFn(...args) {\n      if (!done) {\n        maybeFn(...args)\n      }\n    }\n\n    const args = typeof maybeFn === 'function'\n      ? [stateOrFn, onEnterOrExitFn]\n      : [onSwitchFn]\n\n    const removeListener = bot[eventName](...args)\n\n    return () => {\n      done = true\n      removeListener()\n    }\n  }, [bot, eventName, stateOrFn, maybeFn])\n}\n"],"names":["useState","useEffect","useMemo","Statebot"],"mappings":";;;;;;;;;;;;;;;AAMO,SAAS,WAAW,EAAE,GAAG,EAAE;AAClC,EAAE,MAAM,CAAC,KAAK,EAAE,QAAQ,CAAC,GAAGA,cAAQ,CAAC,GAAG,CAAC,YAAY,EAAE,EAAC;AAExD,EAAEC,eAAS,CAAC,MAAM;AAClB,IAAI,IAAI,IAAI,GAAG,MAAK;AAEpB,IAAI,MAAM,cAAc,GAAG,GAAG,CAAC,UAAU,CAAC,OAAO,IAAI;AACrD,MAAM,IAAI,CAAC,IAAI,EAAE;AACjB,QAAQ,QAAQ,CAAC,OAAO,EAAC;AACzB,OAAO;AACP,KAAK,EAAC;AAEN,IAAI,OAAO,MAAM;AACjB,MAAM,IAAI,GAAG,KAAI;AACjB,MAAM,cAAc,GAAE;AACtB,KAAK;AACL,GAAG,EAAE,CAAC,GAAG,CAAC,EAAC;AAEX,EAAE,OAAO,KAAK;AACd,CAAC;AAOM,SAAS,kBAAkB,CAAC,IAAI,EAAE,MAAM,EAAE;AACjD,EAAE,MAAM,OAAO,GAAGC,aAAO,CAAC,MAAM,MAAM,EAAE,CAAC,IAAI,CAAC,EAAC;AAC/C,EAAE,MAAM,SAAS,GAAG,GAAE;AACtB,EAAED,eAAS,CAAC,MAAM,MAAM,SAAS,CAAC,OAAO,CAAC,GAAG,IAAI,GAAG,EAAE,CAAC,EAAE,CAAC,OAAO,CAAC,EAAC;AAKnE,EAAE,MAAM,GAAG,GAAGC,aAAO,CAAC,MAAM;AAC5B,IAAI,MAAM,EAAE,kBAAkB,EAAE,aAAa,EAAE,GAAG,SAAS,EAAE,GAAG,OAAO,IAAI,GAAE;AAC7E,IAAI,MAAM,GAAG,GAAGC,iBAAQ,CAAC,IAAI,EAAE,SAAS,EAAC;AACzC,IAAI,SAAS,CAAC,IAAI;AAClB,MAAM,GAAG,CAAC,kBAAkB,CAAC,kBAAkB,IAAI,EAAE,CAAC;AACtD,MAAM,GAAG,CAAC,aAAa,CAAC,aAAa,IAAI,EAAE,CAAC;AAC5C,MAAK;AACL,IAAI,OAAO,GAAG;AACd,GAAG,EAAE,CAAC,IAAI,EAAE,OAAO,CAAC,EAAC;AAErB,EAAE,MAAM,KAAK,GAAG,WAAW,CAAC,GAAG,EAAC;AAEhC,EAAE,OAAO,EAAE,KAAK,EAAE,GAAG,EAAE;AACvB,CAAC;AAKM,SAAS,gBAAgB,EAAE,GAAG,EAAE,SAAS,EAAE,SAAS,EAAE,OAAO,EAAE;AACtE,EAAEF,eAAS,CAAC,MAAM;AAElB,IAAI,IAAI,IAAI,GAAG,MAAK;AAEpB,IAAI,SAAS,UAAU,CAAC,GAAG,IAAI,EAAE;AACjC,MAAM,IAAI,CAAC,IAAI,EAAE;AACjB,QAAQ,SAAS,CAAC,GAAG,IAAI,EAAC;AAC1B,OAAO;AACP,KAAK;AACL,IAAI,SAAS,eAAe,CAAC,GAAG,IAAI,EAAE;AACtC,MAAM,IAAI,CAAC,IAAI,EAAE;AACjB,QAAQ,OAAO,CAAC,GAAG,IAAI,EAAC;AACxB,OAAO;AACP,KAAK;AAEL,IAAI,MAAM,IAAI,GAAG,OAAO,OAAO,KAAK,UAAU;AAC9C,QAAQ,CAAC,SAAS,EAAE,eAAe,CAAC;AACpC,QAAQ,CAAC,UAAU,EAAC;AAEpB,IAAI,MAAM,cAAc,GAAG,GAAG,CAAC,SAAS,CAAC,CAAC,GAAG,IAAI,EAAC;AAElD,IAAI,OAAO,MAAM;AACjB,MAAM,IAAI,GAAG,KAAI;AACjB,MAAM,cAAc,GAAE;AACtB,KAAK;AACL,GAAG,EAAE,CAAC,GAAG,EAAE,SAAS,EAAE,SAAS,EAAE,OAAO,CAAC,EAAC;AAC1C;;;;;;"}